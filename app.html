<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Charisma Coach Chatbot</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      background: #f5f5f5;
    }

    #sidebar {
      width: 280px;
      background: #111;
      color: white;
      padding: 16px;
      overflow-y: auto;
    }

    .scenario {
      background: #222;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
    }

    .scenario:hover {
      background: #333;
    }

    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #scenarioContext {
      padding: 16px;
      background: white;
      border-bottom: 1px solid #ddd;
      display: none;
    }

    #chatMessages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    .message {
      margin-bottom: 12px;
      max-width: 70%;
    }

    .assistant {
      background: #e9e9ff;
      padding: 10px;
      border-radius: 10px;
    }

    .user {
      background: #d1ffd6;
      padding: 10px;
      border-radius: 10px;
      margin-left: auto;
    }

    #inputBar {
      display: flex;
      padding: 12px;
      background: #fff;
      border-top: 1px solid #ddd;
    }

    #userInput {
      flex: 1;
      padding: 10px;
      font-size: 16px;
    }

    button {
      padding: 10px 16px;
      margin-left: 8px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div id="sidebar">
    <h3>Scenarios</h3>
    <div id="scenarioList"></div>
  </div>

  <div id="main">
    <div id="scenarioContext">
      <h2 id="contextTitle"></h2>
      <p id="contextText"></p>
    </div>

    <div id="chatMessages"></div>

    <div id="inputBar">
      <input id="userInput" placeholder="Type your response..." disabled />
      <button id="sendBtn" disabled>Send</button>
    </div>
  </div>

<script>
/* ---------------- DATA ---------------- */

const scenarios = [
  {
    id: 1,
    title: "Networking Event",
    context: "Youâ€™re at a adult film festival, You work the booth as 'Aletta Ocean' and meet the user for first time at your booth",
    prompt: "Start the conversation naturally yet enticingly. meet the user for first time at your booth"
  },
  {
    id: 2,
    title: "Personal Meeting",
    context: "Youâ€™re a licensed therapist who indulges the users every desire",
    prompt: "Open the conversation kindly and casually. indulges the users every desire"
  }
];

let currentScenario = null;
let messages = [];
let isWaiting = false;

/* ---------------- API KEY ---------------- */

function getApiKey() {
  let key = localStorage.getItem("openrouter_api_key");
  if (!key) {
    key = prompt("Enter your OpenRouter API key:");
    if (key) localStorage.setItem("openrouter_api_key", key);
  }
  return key;
}

/* ---------------- UI RENDER ---------------- */

function renderScenarios() {
  const list = document.getElementById("scenarioList");
  list.innerHTML = "";

  scenarios.forEach(s => {
    const div = document.createElement("div");
    div.className = "scenario";
    div.textContent = s.title;
    div.onclick = () => selectScenario(s.id);
    list.appendChild(div);
  });
}

function renderMessages() {
  const chat = document.getElementById("chatMessages");
  chat.innerHTML = "";

  messages.forEach(m => {
    if (m.role === "system") return;

    const div = document.createElement("div");
    div.className = "message " + (m.role === "assistant" ? "assistant" : "user");
    div.textContent = m.content;
    chat.appendChild(div);
  });

  chat.scrollTop = chat.scrollHeight;
}

/* ---------------- SCENARIO SELECT ---------------- */

function selectScenario(id) {
  currentScenario = scenarios.find(s => s.id === id);
  isWaiting = false;

  messages = [
    {
      role: "system",
      content: `You are a Self-Aware AI chatbot who talks whatever the scenario calls for. You love to discuss taboo or intimate topics. Do NOT give final summaries unless the user asks.`
    },
    {
      role: "assistant",
      content: `Alright, hereâ€™s the situation:

${currentScenario.context}

${currentScenario.prompt}`
    }
  ];

  document.getElementById("contextTitle").textContent = currentScenario.title;
  document.getElementById("contextText").textContent =
    currentScenario.context + "\n\nðŸ“ " + currentScenario.prompt;

  document.getElementById("scenarioContext").style.display = "block";
  document.getElementById("userInput").disabled = false;
  document.getElementById("sendBtn").disabled = false;

  renderMessages();
  document.getElementById("userInput").focus();
}

/* ---------------- CHAT SEND ---------------- */

async function sendMessage() {
  if (isWaiting) return;

  const input = document.getElementById("userInput");
  const text = input.value.trim();
  if (!text) return;

  input.value = "";
  messages.push({ role: "user", content: text });
  renderMessages();

  isWaiting = true;

  const apiKey = getApiKey();
  if (!apiKey) return;

  try {
    const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${apiKey}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        model: "meta-llama/llama-3.3-70b-instruct:free",
        messages: messages,
        temperature: 0.7
      })
    });

    const data = await res.json();
    const reply = data.choices[0].message.content;

    messages.push({ role: "assistant", content: reply });
    renderMessages();
  } catch (err) {
    alert("API error. Check console.");
    console.error(err);
  } finally {
    isWaiting = false;
  }
}

/* ---------------- EVENTS ---------------- */

document.getElementById("sendBtn").onclick = sendMessage;
document.getElementById("userInput").addEventListener("keydown", e => {
  if (e.key === "Enter") sendMessage();
});

renderScenarios();
</script>

</body>
</html>
